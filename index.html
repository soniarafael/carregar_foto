<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envio de Arquivos para o Google Drive</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://apis.google.com/js/platform.js"></script>
</head>
<body>
    <h2>Escolha Imagens ou Vídeos para Enviar ao Google Drive</h2>
    
    <!-- Botão de Autorização -->
    <button id="authorize_button" style="display: none;" onclick="handleAuthClick()">Autorizar</button>

    <!-- Botão de Envio de Arquivo -->
    <button id="upload_button" style="display: none;" onclick="uploadFile()">Enviar Arquivo</button>

    <!-- Input de Seleção de Arquivos -->
    <input type="file" id="fileInput" multiple accept="image/*,video/*">

    <script>
        const CLIENT_ID = '268910905388-of8s4kn83obp1h7dus6k4hj9h0dpehnv.apps.googleusercontent.com'; // Substitua com o seu Client ID OAuth 2.0
        const API_KEY = 'AIzaSyCbR_Qz8ijrNrhexu-G19zdgHwOWd4R2lc'; // Substitua com a sua API Key
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let accessToken = '';

        // Carrega a API do Google Drive
        function loadClient() {
            gapi.client.setApiKey(API_KEY);
            gapi.client.load("https://content.googleapis.com/discovery/v1/apis/drive/v3/rest").then(() => {
                gapi.auth2.init({
                    client_id: CLIENT_ID,
                    scope: SCOPES
                }).then(() => {
                    checkAuth();
                });
            });
        }

        // Verifica se o usuário está autenticado
        function checkAuth() {
            const authInstance = gapi.auth2.getAuthInstance();
            if (authInstance.isSignedIn.get()) {
                document.getElementById("authorize_button").style.display = "none";
                document.getElementById("upload_button").style.display = "inline-block";
                document.getElementById("fileInput").style.display = "inline-block";
            } else {
                document.getElementById("authorize_button").style.display = "inline-block";
                document.getElementById("upload_button").style.display = "none";
                document.getElementById("fileInput").style.display = "none";
            }
        }

        // Realiza o login e autorização
        function handleAuthClick() {
            gapi.auth2.getAuthInstance().signIn().then(() => {
                accessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
                checkAuth();
            });
        }

        // Função para enviar arquivos ao Google Drive
        function uploadFile() {
            const fileInput = document.getElementById("fileInput");
            if (fileInput.files.length === 0) {
                alert("Selecione pelo menos um arquivo!");
                return;
            }

            for (const file of fileInput.files) {
                const metadata = {
                    name: file.name,
                    mimeType: file.type
                };

                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', file);

                fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart", {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                    body: form
                }).then((response) => response.json()).then((data) => {
                    if (data.id) {
                        alert("Arquivo enviado com sucesso!");
                    } else {
                        alert("Erro ao enviar arquivo.");
                    }
                }).catch((error) => {
                    console.error('Erro no upload:', error);
                    alert("Erro ao enviar o arquivo.");
                });
            }
        }

        function start() {
            gapi.load('client:auth2', loadClient);
        }

        start();
    </script>
</body>
</html>
